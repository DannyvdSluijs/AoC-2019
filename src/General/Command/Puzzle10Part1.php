<?php declare(strict_types=1);

namespace AoC\General\Command;

use AoC\General\Model\RealIntCodeComputer;
use Symfony\Component\Console\Command\Command;
use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Output\OutputInterface;

class Puzzle10Part1 extends Command
{
    protected static $defaultName = 'puzzle-10-part-1';

    protected function execute(InputInterface $input, OutputInterface $output): int
    {
        $asteroidMap = $this->getPuzzleInput();
        $asteroids = [];
        $maxLinesOfSight = 0;

        foreach (explode("\n", $asteroidMap) as $y => $line) {
            foreach (str_split($line) as $x => $item) {
                if ($item !== '#') {
                    continue;
                }
                $asteroids[] = (object) ['x' => $x, 'y' => $y];
            }
        }

        foreach ($asteroids as $asteroid) {
            $angles = [];

            foreach ($asteroids as $other) {
                /* Same asteroid */
                if ($asteroid->x === $other->x && $asteroid->y === $other->y) {
                    continue;
                }

                $xDiff = $other->x - $asteroid->x;
                $yDiff = $asteroid->y - $other->y;

                $angle = (rad2deg(atan2($xDiff, $yDiff)) + 360) * 1000 % 360000;

                $angles[] = $angle;
            }

            $count = count(array_unique($angles));

            if ($count > $maxLinesOfSight) {
                $maxLinesOfSight = $count;
                $output->writeln("Found new max $maxLinesOfSight at asteroid {$asteroid->x},{$asteroid->y}");
            }
        }

        $output->writeln("Part one: $maxLinesOfSight");
        return 1;
    }

    private function getPuzzleInput(): string
    {
        return '#.#................#..............#......#......
.......##..#..#....#.#.....##...#.........#.#...
.#...............#....#.##......................
......#..####.........#....#.......#..#.....#...
.....#............#......#................#.#...
....##...#.#.#.#.............#..#.#.......#.....
..#.#.........#....#..#.#.........####..........
....#...#.#...####..#..#..#.....#...............
.............#......#..........#...........#....
......#.#.........#...............#.............
..#......#..#.....##...##.....#....#.#......#...
...#.......##.........#.#..#......#........#.#..
#.............#..........#....#.#.....#.........
#......#.#................#.......#..#.#........
#..#.#.....#.....###..#.................#..#....
...............................#..........#.....
###.#.....#.....#.............#.......#....#....
.#.....#.........#.....#....#...................
........#....................#..#...............
.....#...#.##......#............#......#.....#..
..#..#..............#..#..#.##........#.........
..#.#...#.......#....##...#........#...#.#....#.
.....#.#..####...........#.##....#....#......#..
.....#..#..##...............................#...
.#....#..#......#.#............#........##...#..
.......#.....................#..#....#.....#....
#......#..###...........#.#....#......#.........
..............#..#.#...#.......#..#.#...#......#
.......#...........#.....#...#.............#.#..
..##..##.............#........#........#........
......#.............##..#.........#...#.#.#.....
#........#.........#...#.....#................#.
...#.#...........#.....#.........#......##......
..#..#...........#..........#...................
.........#..#.......................#.#.........
......#.#.#.....#...........#...............#...
......#.##...........#....#............#........
#...........##.#.#........##...........##.......
......#....#..#.......#.....#.#.......#.##......
.#....#......#..............#.......#...........
......##.#..........#..................#........
......##.##...#..#........#............#........
..#.....#.................###...#.....###.#..#..
....##...............#....#..................#..
.....#................#.#.#.......#..........#..
#........................#.##..........#....##..
.#.........#.#.#...#...#....#........#..#.......
...#..#.#......................#...............#';
    }
}
